---
# tasks file for zsh
- name: Install zsh package
  package:
    name:
      - zsh
      - zsh-syntax-highlighting
    state: present

- name: Set as default shell
  user:
    name: "{{ desktop_user.username }}"
    shell: /bin/zsh

- name: Create zfunction directory
  become: true
  become_user: "{{ desktop_user.username }}"
  file:
    state: directory
    mode: 0755
    owner: "{{ desktop_user.username }}"
    dest: "~/.zfunctions"

- name: Install zsh configuration
  become: true
  become_user: "{{ desktop_user.username }}"
  template:
    mode: 0644
    src: zshrc.j2
    owner: "{{ desktop_user.username }}"
    dest: "~/.zshrc"

- name: Install zshenv configuration
  become: true
  become_user: "{{ desktop_user.username }}"
  template:
    mode: 0644
    src: zshenv.j2
    owner: "{{ desktop_user.username }}"
    dest: "~/.zshenv"

- name: Copy async library
  become: true
  become_user: "{{ desktop_user.username }}"
  copy:
    src: "{{ role_path }}/templates/async.zsh"
    dest: "~/.zfunctions/async"
    owner: "{{ desktop_user.username }}"

- name: Clone powerline theme
  become: yes
  become_user: "{{ desktop_user.username }}"
  git:
    repo: https://github.com/romkatv/powerlevel10k.git
    dest: ~/.powerlevel10k
    depth: 1
    update: yes

- name: Use powerline theme
  become: yes
  become_user: "{{ desktop_user.username }}"
  lineinfile:
    dest: "~/.zshrc"
    line: "source ~/.powerlevel10k/powerlevel10k.zsh-theme"

- name: Copy powerline 10k configuration
  become: yes
  become_user: "{{ desktop_user.username }}"
  copy:
    src: "{{ role_path }}/templates/p10k.zsh"
    dest: "~/.p10k.zsh"
    owner: "{{ desktop_user.username }}"

- name: Copy aliases
  become: true
  become_user: "{{ desktop_user.username }}"
  copy:
    src: "{{ role_path }}/templates/aliases"
    dest: "~/.aliases"
    owner: "{{ desktop_user.username }}"

- name: Add additional zsh-completions
  become: true
  become_user: "{{ desktop_user.username }}"
  git:
    repo: https://github.com/zsh-users/zsh-completions.git
    dest: "~/.zcompletions"
    update: yes

- name: Clone zsh-autosuggestions
  become: true
  become_user: "{{ desktop_user.username }}"
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions
    dest: ~/.zsh/zsh-autosuggestions
    update: yes

- name: Install zsh-autosuggestions
  become: true
  become_user: "{{ desktop_user.username }}"
  lineinfile:
    dest: ~/.zshrc
    line: "source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh"

- name: Install zsh-syntaxhighlighting
  become: true
  become_user: "{{ desktop_user.username }}"
  lineinfile:
    dest: ~/.zshrc
    line: "source /usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
