---
# tasks file for zsh
- name: Install zsh package
  package:
    name: zsh
    state: present

- name: Set as default shell
  user:
    name: "{{ item.username }}"
    shell: /bin/zsh
  with_items: "{{ users }}"

- name: Create zfunction directory
  become: true
  become_user: "{{ item.username }}"
  file:
    state: directory
    mode: 0755
    owner: "{{ item.username }}"
    dest: "~/.zfunctions"
  with_items: "{{ users }}"

- name: Install zsh configuration
  become: true
  become_user: "{{ item.username }}"
  template:
    mode: 0644
    src: zshrc.j2
    owner: "{{ item.username }}"
    dest: "~/.zshrc"
  with_items: "{{ users }}"

- name: Install zprofile configuration
  become: true
  become_user: "{{ item.username }}"
  template:
    mode: 0644
    src: zshenv.j2
    owner: "{{ item.username }}"
    dest: "~/.zshenv"
  with_items: "{{ users }}"

- name: Copy async library
  become: true
  become_user: "{{ item.username }}"
  copy:
    src: "{{ role_path }}/templates/async.zsh"
    dest: "~/.zfunctions/async"
    owner: "{{ item.username }}"
  with_items: "{{ users }}"

- name: Copy pure theme
  become: true
  become_user: "{{ item.username }}"
  copy:
    src: "{{ role_path }}/templates/pure.zsh"
    dest: "~/.zfunctions/prompt_pure_setup"
    owner: "{{ item.username }}"
  with_items: "{{ users }}"

- name: Copy aliases
  become: true
  become_user: "{{ item.username }}"
  copy:
    src: "{{ role_path }}/templates/aliases"
    dest: "~/.aliases"
    owner: "{{ item.username }}"
  with_items: "{{ users }}"

- name: Add additional zsh-completions
  become: true
  become_user: "{{ item.username }}"
  git:
    repo: https://github.com/zsh-users/zsh-completions.git
    dest: "~/.zcompletions"
    update: yes
  with_items: "{{ users }}"
