- name: emacs.d exists
  become: yes
  become_user: "{{ user.username }}"
  stat:
    path: "~/.emacs.d/"
    follow: yes
  register:
    emacsd

- name: Clone .emacs.d
  become: yes
  become_user: "{{ user.username }}"
  git:
    repo: https://github.com/syl20bnr/spacemacs.git
    dest: ~/.emacs.d/
    update: yes
  when: emacsd.stat.exists == False

- name: Clone extension layer
  become: yes
  become_user: "{{ user.username }}"
  git:
    repo: https://github.com/bergmannf/private-extension-layer.git
    dest: ~/.emacs.d/private/priv-ext/
    update: yes
